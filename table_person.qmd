
## PERSON

### OMOP CDM 5.4 - OMOP.PERSON
This table serves as the central identity management for all Persons in the OMOP data model. It contains records that uniquely identify each person or patient, and some demographic information. 
```{mermaid}
erDiagram
    PERSON {
        person_id integer "[PK not null] autogenerated identifier"
        gender_concept_id integer "[not null]"
        year_of_birth integer "[not null]"
        month_of_birth integer
        day_of_birth integer
        birth_datetime timestamp
        race_concept_id integer "[not null] race or ethnicity"
        ethnicity_concept_id integer "[not null] US-specific hispanic vs non-hispanic"
        location_id integer "patient physical address"
        provider_id integer "GP who is primary care provider"
        care_site_id integer "GP surgery for primary care"
        person_source_value varchar50 "person identifer source value"
        gender_source_value varchar50 "biological sex as represented in source"
        gender_source_concept_id integer "mapping to omop, but often empty"
        race_source_value varchar50 "race or ethnicity as represented in source"
        race_source_concept_id integer "mapping to omop, but often empty"
        ethnicity_source_value varchar50 "US-specific as represented in source"
        ethnicity_source_concept_id integer "mapping to omop, but often empty"
    }
```

### IMPLEMENTATION - SILVER.PERSON

SILVER.PERSON is the filtered, cleaned, and transformed version of ingested person and demographic tables, that is used to stage vanilla OMOP CDM5.4 tables (as well as other GOLD transformations). This table is wider than the OMOP data model, and includes the following differences:

- Surfaces both person_nhs_number and person_mrn (NHS hospital patients have two unique identifiers);
- Standardised concept codes/names are surfaced, and indexed, to enable user-friendly exploration and visualisation without the need for large joins;
- Source concept codes/names are surfaced to enable direct visibility over semantic provenance;
- An additional demographic field for deprivation is included; 
- OMOP CDM 5.4 columns that are not relevant to the NHS, or to intended purposes, are initialised, but set as null, and remain empty when carried into OMOP.PERSON.  

```{mermaid}
erDiagram
    SILVER_PERSON {
        person_id integer "[PK]"
        person_nhs_number integer "[NEW]"
        person_mrn varchar50 "[NEW]"
        gender_concept_id integer "[not null]"
        gender_concept_code varchar50 "[NEW] standard concept code"
        gender_concept_name varchar50 "[NEW] standard concept name"
        year_of_birth integer "[not null]"
        month_of_birth integer
        day_of_birth integer
        birth_datetime timestamp "[set as null]"
        race_concept_id integer "[not null] race or ethnicity"
        race_concept_code varchar50 "[NEW] standard concept code"
        race_concept_name varchar50 "[NEW] standard concept name"
        deprivation_index_as_number integer "[NEW] constrain to NHS IMD definitions"       
        ethnicity_concept_id integer "[set as null]"
        location_id integer "[set as null]"
        provider_id integer "[set as null]"
        care_site_id integer "[set as null]"
        person_source_value varchar50 "contains mrn"
        gender_source_value varchar50 "biological sex source code"
        gender_source_value_name varchar50 "[NEW] biological sex source name"
        gender_source_concept_id integer "[set as null]"
        race_source_value varchar50 "ethnicity code as in source"
        race_source_value_name varchar50 "[NEW] ethnicity name as in source"
        race_source_concept_id integer "[set as null]"
        ethnicity_source_value varchar50 "[set as null]"
        ethnicity_source_concept_id integer "[set as null]"    
    }

SILVER_PERSON ||--|| OMOP_PERSON: view

    OMOP_PERSON {
        person_id integer "[PK not null] autogenerated identifier"
        gender_concept_id integer "[not null]"
        year_of_birth integer "[not null]"
        month_of_birth integer
        day_of_birth integer
        birth_datetime timestamp "[set_as_null]"
        race_concept_id integer "[not null] race or ethnicity"
        ethnicity_concept_id integer "[set_as_null]"
        location_id integer "[set_as_null]"
        provider_id integer "[set_as_null]"
        care_site_id integer "[set_as_null]"
        person_source_value varchar50 "contains mrn"
        gender_source_value varchar50 "biological sex source code"
        gender_source_concept_id integer "[set_as_null]"
        race_source_value varchar50 "ethnicity code as in source"
        race_source_concept_id integer "[set_as_null]"
        ethnicity_source_value varchar50 "[set_as_null]"
        ethnicity_source_concept_id integer "[set_as_null]"
    }
```


### ADDITIONAL NOTES

#### Person ID generation
While hospitals make effort to keep MRN numbers unique, it is possible that a single patient may have multiple MRNs. An option is to use NHS numbers, but these are not always available or compulsory in the record (e.g. patients from overseas may not have NHS numbers). As such person_id is based on MRN (see Person disambiguation).

#### Table and systems provenance
As fields in this table may be derived from different source tables, we do not directly surface row or systems lineage within PERSON tables.

### OUTSTANDING ISSUES

#### Changes in person characteristics
Rows in OMOP.PERSON / SILVER.PERSON for a given person_id are not necessarily immutable, as demographic information may appear differently over different records (e.g. corrections, changes over time). When a demographic value is updated in a person's record, there should be a way to load into table and surface differences without destroying historical data (i.e. the ability to reproduce analyses must be preserved).

One possibility is to use validity flags and start/end dates to handle future changes to person details/demographics, either to correct for mistakes, or because demographic information has changed. This may necessiate using a valid start date column to create a composite PK. 

#### Person disambiguation
Prior to generating any new person_ids, there needs to be a process of disambiguation by checking against MRNs that are known to represent the same patient. To incorporate this into the model, it may be necessary to incorporate a person disambiguation table that enables a many-to-one mapping of person_ids.

### VERSION TRACKING

_JZ 2024-June-28_: initial version, loaded original omop table and suggested SILVER model.